---
title: "Factors affecting physical characteristics of birds"
subtitle: ""
author: "Fire Emoji (ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥) <br> Beth, Beatrice, Faaiz, Mohsin"
institute: "University of Edinburgh"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      
---

```{r install-package, include = FALSE, eval = FALSE}
# Copy and paste the following code into your console to download and install
# the `xaringan` package that contains all of the code which allows you 
# to create presentation slides in Rmarkdown
install.packages('xaringan')
install.packages("xaringanthemer")
install.packages("kableExtra")
```


```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(readxl)
library(kableExtra)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r xaringan-tachyons, echo=FALSE}
xaringanExtra::use_tachyons()
```

```{r xaringanExtra, echo = FALSE}
xaringanExtra::use_progress_bar(color = "#548B54", location = "top")
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent(
  base_color = "#556B2F",
  header_font_google = google_font("Josefin Sans"),
  text_font_google   = google_font("Montserrat", "300", "300"),
  code_font_google   = google_font("Fira Mono")
)

```


```{r load-data, include=FALSE}
# Load your data here
AVONET3_BirdTree <- read_excel("data/AVONET3_BirdTree.xlsx", 
    sheet = "AVONET3_BirdTree")
```


# Introduction

We chose to investigate the AVONET Bird dataset. This dataset includes many traits of various species of birds, such as physical characteristics, geographical location and other ecological variables.

The dataset contains 9,993 observations with 36 columns. However we will only be utilising 6 variables for our investigation.

We analysed this data in order to answer the following research question:


.bg-washed-green.b--dark-green.ba.bw2.br3.shadow-5.ph4.mt5[
What is the relationship between beak length, mass, and trophic level amongst different habitats?

.tr[

]]


---
# The variables being used:
.pull-left[
- Species, Total Individuals, Habitat, Trophic Level, Culmen Length and Mass

- We decided to separate the birds by habitat, because we assumed the food available will differ by each habitat, and consequently so will the eating habits of the birds. 
]
--
.pull-right[
- Culmen length of a bird:

```{r culmen, out.width = "100%", fig.width = 4, echo = FALSE}
include_graphics("img/bird_culmen.png")
```
<br> by Beatrice
]
---

# Total individuals within each habitat
.pull-left[
```{r, out.width= "100%", fig.width= 8, echo=FALSE}
Bird_data <- AVONET3_BirdTree %>%
  select(Species3, Total.individuals, Beak.Length_Culmen, Habitat, Trophic.Level, Trophic.Niche, Mass) %>%
  filter(Total.individuals > 5)
 

Total_Habitat <- Bird_data %>%
  group_by(Habitat) %>%
  summarise(total.birds = sum(Total.individuals)) %>%
  filter(Habitat != "NA")



ggplot(data  = Total_Habitat, 
       aes(x = Habitat,
           y = total.birds,
           fill = Habitat)) +
         geom_col() +
  theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10)) +
      scale_fill_brewer(type = "div",
                        palette = 9,
                        direction = 1,
                        aesthetics = "fill") +
  labs(title = "Total bird count within each habitat",
       x = "Habitat",
       y = "Total Birds")
```
]

--

.pull-right[
- This bar chart shows the number of total individuals recorded within each habitat.

- The visualisation shows that the overwhelming majority of individuals were recorded within the forest habitat.

]

---

# Histrogram showing frequency of culmen length

.pull-left[
```{r, echo=FALSE}
histogram <- ggplot(Bird_data, 
       aes(
         x = Beak.Length_Culmen, 
         weight = Total.individuals)) +
  geom_histogram(binwidth = 0.2, fill = "steelblue") +
  labs(title = "Histogram of Beak Lengths (Weighted by Individuals)",
       x = "Beak Length (Culmen)", 
       y = "Total Individuals") +
  scale_x_continuous(limits = c(0, 100)) +
  theme_minimal() +
  geom_vline(xintercept = c(8, 25), 
             linetype = "dashed", 
             color = "red") 

suppressWarnings(print(histogram))
```
]

--

.pull-right[
- We calculated that three quarters of the birds have culmen lengths between the values of 8 and 25

- We calculated that the median of the Culmen Lengths was 19.6 mm

- There were few values above 100 mm, but we changed the scale of the visualisation in order to increase readability

]

---

# Scatterplot of mass and culmen length
### With a linear regression

.pull-left[
```{r, out.width= "100%", fig.width= 6, echo=FALSE}
birds.data_mass <- Bird_data %>%
  select(Species3, Total.individuals, Beak.Length_Culmen, Habitat, Mass, Trophic.Level)%>%
  mutate(Mass_kg = Mass/1000,
         log_mass_kg = log(Mass_kg), log_culmen = log(Beak.Length_Culmen)) %>%
  filter(Trophic.Level != "NA")

ggplot(data = birds.data_mass,
       mapping = aes(x = log_culmen,
                     y = log_mass_kg)) +
  geom_point(alpha = 0.6, size = 0.6, mapping = aes(colour = Trophic.Level)) +
  geom_smooth(method = lm, se = FALSE, formula = y ~ x) +
  labs(
    title = "Bird Culmen Length vs. Mass",
    subtitle = "by trophic level",
    x = "Log of Culmen Length (mm)", 
    y = "Log of Mass (kg)",
    colour = "Trophic Level"
  ) +
  scale_colour_manual(values = c(
    "Carnivore" = "#88419d",
    "Herbivore" = "#d7b5d8",
    "Omnivore" = "#41b6c4",
    "Scavenger" = "#0570b0"
  )) +
  theme_minimal() +
  theme(legend.title = element_text(size = 12))
```
]


--
```{r, echo=FALSE}
linear_reg() %>%
  set_engine("lm") %>%
  fit(log_mass_kg ~ log_culmen, data = birds.data_mass) %>%
  tidy()
```
.pull-right[

- The scatterplot shows a positive correlation between the log of the variables.

- The linear regression gives the equation log(Mass_kg) = -9.585 + 2.085*log(Culmen Length)

- Birds in the carnivore trophic level has the largest spread between data points, due to the fact it is the largest trophic level and so will contain the most variety.

]

---
```{r, echo=FALSE, warning=FALSE}
#setting up the ROC curve 
size_data <- mutate(Bird_data,
                    size =
                    factor(case_when(
                      Beak.Length_Culmen < 20.0 ~ "Small",
                      Beak.Length_Culmen >= 20.0 ~ "Big"
                      )))

bird_split <- initial_split(size_data, prop = 0.80)

train_data <- training(bird_split)
test_data  <- testing(bird_split)

bird_rec <- recipe(
  size ~ Habitat + Trophic.Level + Mass,       
  data = train_data 
  ) %>%
  step_dummy(all_nominal(), -all_outcomes())

bird_mod <- logistic_reg() %>%
  set_engine("glm") 

bird_wkflow <- workflow() %>% 
  add_model(bird_mod) %>% 
  add_recipe(bird_rec)

bird_fit <- bird_wkflow %>%
  fit(data = train_data)

```


# Model Analysis

.pull-left[
```{r, out.width = "120%", fig.width= 5, echo=FALSE}
bird_pred <- predict(bird_fit, test_data, type = "prob") %>% 
  bind_cols(test_data)

bird_pred %>%
  roc_curve(
    truth = size,
    .pred_Small,
    event_level = "second"
  ) %>%
  autoplot()

```

]

--
```{r, fig.width = 3, echo=FALSE}
cutoff_prob <- 0.5
bird_table <- bird_pred %>%
  mutate(
    size      = if_else(size == "Small", "Bird Beak is Small", "Bird Beak is Big"),
    size_pred = if_else(.pred_Small > cutoff_prob, "Bird labelled Small", "Bird labelled Big")
    ) %>%
  count(size_pred, size) %>%
  pivot_wider(names_from = size, values_from = n) 

bird_table %>%
  kbl() %>%
  kable_styling(font_size = 18)

```
.pull-right[
- We created a logistic model which predicts the beak length of a bird based on the factors; habitat, mass and trophic level

- The median of culmen lengths is 19.6 mm so we decided to split beak lengths into big and small by the cutoff 20 mm

- The area under the ROC curve is 0.868, indicating the logistic model has great predictive strength

- The sensitivity is 0.933, and specificity 0.688

- The model has overall good predictive strength
]

---

# Math Expressions

You can write LaTeX math expressions inside a pair of dollar signs, e.g. &#36;\alpha+\beta$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1. The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

1. There should not be spaces after the opening `$` or before the closing `$`.

1. Math does not work on the title slide (see [#61](https://github.com/yihui/xaringan/issues/61) for a workaround).


